<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sektoral</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<!-- ===== Appbar (sama pola Beranda) ===== -->
<div class="appbar">
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <!-- <div class="badge" aria-hidden="true"></div> -->
        <div class="logo-container">
          <img src="assets/Logo_KLH.png" alt="Logo 1" class="logo1">
          <!-- <img src="assets/UNDP_logo.png" alt="Logo 2" class="logo2 "> -->
          <b>Dashboard MoNEv Adaptasi</b>
          <!-- <small class="muted">Sektoral • Ringkas capaian & kualitas data</small> -->
        </div>
      </div>

      <div class="userbox">
        <div class="searchbox">
          <span class="sicon" aria-hidden="true">⌕</span>
          <input id="globalSearch" type="search" placeholder="Cari indikator, aksi, instansi…" />
        </div>

        <button class="helpbtn" id="helpBtn" type="button" title="Bantuan">?</button>
        <span class="avatar" title="User"></span>
      </div>
    </div>
  </div>

  <div class="tabbar">
    <div class="inner tabrow">
      <div class="pagehead">
        <h1>Sektoral</h1>
        <div class="sub">Bandingkan capaian, indikator, dan kualitas data per sektor.</div>
      </div>

      
      <nav class="menu menu-right">
        <div class="dd active">
          <button class="dd-btn active" type="button">Dashboard ▾</button>
          <div class="dd-menu">
            <a href="index.html" class="">Beranda</a>
            <a href="horizontal.html" class="active">Dashboard Horizontal</a>
            <a href="vertical.html" class="">Dashboard Vertikal</a>
            <a href="impact.html" class="">Dashboard Impact</a>
          </div>
        </div>
        <a href="horizontal_guideline.html" class="">Horizontal</a>
        <a href="vertical_guideline.html" class="">Vertikal</a>
        <a href="impact_assessment.html" class="">Impact</a>
        <a href="aksi_pembiayaan.html" class="">Aksi &amp; Pembiayaan</a>
        <a href="pelaporan.html" class="">Pelaporan</a>
        <!-- <a href="index.html" class="active">Beranda</a> -->

        <!-- <div class="dd">
          <button class="dd-btn" type="button">Horizontal ▾</button>
          <div class="dd-menu">
            <a href="horizontal.html" class="">Dashboard Horizontal</a>
            <a href="horizontal_guideline.html" class="">Guideline Horizontal</a>
          </div>
        </div>

        <div class="dd">
          <button class="dd-btn" type="button">Vertikal ▾</button>
          <div class="dd-menu">
            <a href="vertical.html" class="">Dashboard Vertikal</a>
            <a href="vertical_guideline.html" class="">Guideline Vertikal</a>
          </div>
        </div>

        <div class="dd">
          <button class="dd-btn" type="button">Impact ▾</button>
          <div class="dd-menu">
            <a href="impact.html" class="">Dashboard Impact</a>
            <a href="impact_assessment.html" class="">Impact Assessment</a>
          </div>
        </div> -->
      </nav>
    </div>
  </div>
</div>
<!-- ===== /Appbar ===== -->


<div class="wrap">

  <!-- ===== Filter bar ===== -->
  <section class="grid">
    <div class="card span-12">
      <div class="bd toolbar">
        <div class="toolleft">
          <div class="tooltitle">Filter</div>
          <div class="toolsub muted">Atur periode & sektor, lalu gunakan pencarian untuk menyaring tabel.</div>
        </div>

        <div class="toolright">
          <label class="muted" for="period">Periode</label>
          <select id="period">
            <option value="2023">2023</option>
            <option value="2024">2024</option>
            <option value="2025" selected>2025</option>
          </select>

          <label class="muted" for="sector">Sektor</label>
          <select id="sector">
            <option value="Pangan" selected>Pangan</option>
            <option value="Air">Air</option>
            <option value="Kesehatan">Kesehatan</option>
            <option value="Pesisir">Pesisir</option>
            <option value="Energi">Energi</option>
          </select>

          <!-- <button id="btnMeta" type="button">Metadata</button>
          <button id="btnQA" type="button">QA/QC</button>
          <button class="primary" id="btnExport" type="button">Ekspor</button> -->
        </div>
      </div>
    </div>

    <!-- KPI row -->
    <div class="card span-3">
      <div class="bd kpi">
        <div class="label">Aksi (SRN) — sektor</div>
        <div class="value" id="kpiActions">—</div>
        <div class="pill" id="pillActions">SRN</div>
      </div>
    </div>

    <div class="card span-3">
      <div class="bd kpi">
        <div class="label">Indikator terlapor</div>
        <div class="value" id="kpiIndicators">—</div>
        <div class="pill">Lamp. III</div>
      </div>
    </div>

    <div class="card span-3">
      <div class="bd kpi">
        <div class="label">Aksi bertag CBT</div>
        <div class="value" id="kpiCBT">—</div>
        <div class="pill">Pembiayaan</div>
      </div>
    </div>

    <div class="card span-3">
      <div class="bd kpi">
        <div class="label">Kualitas data</div>
        <div class="value" id="kpiQuality">—</div>
        <div class="pill good" id="pillQuality">QA/QC</div>
      </div>
    </div>

    <!-- Charts -->
    <div class="card span-6">
      <div class="hd">
        <div>
          <div class="h">Tren Aksi Sektoral</div>
          <div class="s">Perubahan jumlah aksi terdaftar antarperiode.</div>
        </div>
        <span class="pill">Tren</span>
      </div>
      <div class="bd">
        <canvas id="trendChart" width="900" height="320" aria-label="Tren Aksi Sektoral"></canvas>
        <div class="footer-note">Catatan: visual dummy untuk uji UX; nantinya diikat ke data SRN.</div>
      </div>
    </div>

    <div class="card span-6">
      <div class="hd">
        <div>
          <div class="h">Kelengkapan Pelaporan Indikator</div>
          <div class="s">Persentase indikator yang terlapor (ringkas per kelompok instansi).</div>
        </div>
        <span class="pill">Kelengkapan</span>
      </div>
      <div class="bd">
        <canvas id="completenessChart" width="900" height="320" aria-label="Kelengkapan Indikator"></canvas>
        <div class="footer-note">Catatan: untuk prioritas perbaikan data, bukan klaim dampak.</div>
      </div>
    </div>

    <!-- Table -->
    <div class="card span-12">
      <div class="hd">
        <div>
          <div class="h">Indikator & Aksi (Ringkas)</div>
          <div class="s">Gunakan search untuk menyaring baris; klik tombol untuk lihat metadata/QA/QC.</div>
        </div>
        <span class="pill">Tabel</span>
      </div>
      <div class="bd">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:18%">Indikator</th>
                <th style="width:16%">Instansi</th>
                <th style="width:20%">Sumber data</th>
                <th style="width:20%">Keterpautan sistem</th>
                <th style="width:14%">Status</th>
                <th style="width:12%">Catatan</th>
              </tr>
            </thead>
            <tbody id="tblBody"></tbody>
          </table>
        </div>
        <div class="footer-note">Catatan: tabel ini mendukung konsistensi antarperiode untuk pelaporan dan pembelajaran.</div>
      </div>
    </div>

  </section>
  <div class="actions">
    <button id="btnMeta">Lihat Metadata</button>
    <button id="btnQA">Lihat Ringkasan QA/QC</button>
    <button class="primary" id="btnExport">Ekspor Ringkasan Sektor</button>
  </div>
</div>

<!-- Help modal -->
<div class="modal" id="helpModal">
  <div class="box">
    <div class="hd">
      <b>Bantuan — Sektoral</b>
      <button class="iconclose" id="helpClose" type="button">✕</button>
    </div>
    <div class="bd">
      <ul class="help-list">
        <li><b>Periode</b> mengubah ringkasan KPI dan visual tren.</li>
        <li><b>Sektor</b> memfilter seluruh tampilan ke sektor terpilih.</li>
        <li><b>Pencarian</b> menyaring tabel indikator/aksi berdasarkan kata kunci.</li>
        <li><b>Metadata</b> menampilkan ringkasan rujukan sistem & konteks data.</li>
        <li><b>QA/QC</b> menampilkan ringkasan status kualitas untuk tindak lanjut.</li>
        <li><b>Ekspor</b> menghasilkan file ringkas (dummy) untuk uji alur kerja.</li>
      </ul>
      <div class="footer-note">Catatan: fitur search saat ini berlaku untuk tabel di halaman ini.</div>
    </div>
  </div>
</div>

<script>
  const DATA = {
    "2023": {
      "Pangan": {actions: 220, indicators: 14, cbt: 98, quality: 90,
        trend:[{p:"2023",v:220},{p:"2024",v:280},{p:"2025",v:320}],
        completeness:[{name:"K/L Utama",v:78},{name:"Lembaga Teknis",v:70},{name:"Pemda",v:62}],
        rows:[
          {ind:"Ketersediaan pangan tahan iklim", inst:"K/L Sektor Pangan", src:"Statistik produksi & kerentanan", sys:["AKSARA","SIPD"], st:"Berjalan", note:"Perlu sinkron definisi"},
          {ind:"Aksi adaptasi irigasi/efisiensi air", inst:"K/L PU", src:"Pelaporan program & SRN", sys:["SRN","CBT"], st:"Berjalan", note:"Tag CBT parsial"},
          {ind:"Perlindungan sosial responsif iklim", inst:"K/L Sosial", src:"Data bantuan & targeting", sys:["AKSARA","CBT"], st:"Perlu Verifikasi", note:"QA sampling"},
          {ind:"Peringatan dini & layanan iklim", inst:"BMKG", src:"Layanan info iklim", sys:["SIPD"], st:"Lengkap", note:"Metadata tersedia"},
        ]
      },
      "Air": {actions: 150, indicators: 12, cbt: 70, quality: 89,
        trend:[{p:"2023",v:150},{p:"2024",v:190},{p:"2025",v:210}],
        completeness:[{name:"K/L Utama",v:74},{name:"Lembaga Teknis",v:66},{name:"Pemda",v:58}],
        rows:[
          {ind:"Keandalan layanan air baku", inst:"K/L PU", src:"Monitoring infrastruktur & layanan", sys:["SIPD","AKSARA"], st:"Berjalan", note:"Butuh definisi reliabilitas"},
          {ind:"Pengurangan risiko banjir perkotaan", inst:"Pemda", src:"Kinerja drainase & kejadian", sys:["SIPD"], st:"Perlu Verifikasi", note:"Validasi titik"},
        ]
      },
      "Kesehatan": {actions: 120, indicators: 10, cbt: 55, quality: 91,
        trend:[{p:"2023",v:120},{p:"2024",v:160},{p:"2025",v:180}],
        completeness:[{name:"K/L Utama",v:80},{name:"Lembaga Teknis",v:72},{name:"Pemda",v:64}],
        rows:[
          {ind:"Kesiapsiagaan heat-health", inst:"K/L Kesehatan", src:"Rencana kontinjensi & layanan", sys:["AKSARA","SIPD"], st:"Berjalan", note:"Butuh indikator layanan"},
        ]
      },
      "Pesisir": {actions: 200, indicators: 11, cbt: 82, quality: 90,
        trend:[{p:"2023",v:200},{p:"2024",v:230},{p:"2025",v:260}],
        completeness:[{name:"K/L Utama",v:76},{name:"Lembaga Teknis",v:69},{name:"Pemda",v:60}],
        rows:[
          {ind:"Perlindungan pesisir berbasis ekosistem", inst:"K/L Lingkungan", src:"Restorasi & monitoring ekosistem", sys:["SRN","CBT"], st:"Berjalan", note:"Perlu konsolidasi"},
        ]
      },
      "Energi": {actions: 90, indicators: 8, cbt: 40, quality: 88,
        trend:[{p:"2023",v:90},{p:"2024",v:120},{p:"2025",v:140}],
        completeness:[{name:"K/L Utama",v:70},{name:"Lembaga Teknis",v:62},{name:"Pemda",v:55}],
        rows:[
          {ind:"Ketahanan energi layanan dasar", inst:"K/L Energi", src:"Kinerja layanan & gangguan", sys:["AKSARA","CBT"], st:"Perlu Verifikasi", note:"Integrasi data gangguan"},
        ]
      }
    },
    "2024": {},
    "2025": {}
  };

  DATA["2024"] = JSON.parse(JSON.stringify(DATA["2023"]));
  DATA["2025"] = JSON.parse(JSON.stringify(DATA["2023"]));

  function tweak(period){
    const factor = period==="2024" ? 1.05 : (period==="2025" ? 1.12 : 1.0);
    for(const s in DATA[period]){
      const o = DATA[period][s];
      o.actions = Math.round(o.actions*factor);
      o.cbt = Math.round(o.cbt*factor);
      o.quality = Math.min(95, o.quality + (period==="2025"?2:(period==="2024"?1:0)));
    }
  }
  tweak("2024"); tweak("2025");

  const $ = (id) => document.getElementById(id);
  function formatInt(n){ return new Intl.NumberFormat("id-ID").format(n); }
  function qualityPill(q){
    if(q >= 92) return {cls:"good", txt:"Baik"};
    if(q >= 90) return {cls:"warn", txt:"Cukup"};
    return {cls:"bad", txt:"Perlu Perbaikan"};
  }

  function clear(ctx, w, h){
    ctx.clearRect(0,0,w,h);
    ctx.save();
    ctx.globalAlpha = 0.12;
    ctx.strokeStyle = "rgba(15,23,42,.45)";
    for(let x=40; x<w; x+=60){ ctx.beginPath(); ctx.moveTo(x, 20); ctx.lineTo(x, h-40); ctx.stroke(); }
    for(let y=20; y<h-40; y+=50){ ctx.beginPath(); ctx.moveTo(40, y); ctx.lineTo(w-20, y); ctx.stroke(); }
    ctx.restore();
  }
  function drawAxes(ctx, w, h, xLabel, yLabel){
    ctx.save();
    ctx.strokeStyle = "rgba(15,23,42,.55)";
    ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(40, 20); ctx.lineTo(40, h-40); ctx.lineTo(w-20, h-40); ctx.stroke();
    ctx.fillStyle = "rgba(15,23,42,.70)";
    ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
    ctx.fillText(yLabel, 40, 14);
    ctx.fillText(xLabel, w-120, h-16);
    ctx.restore();
  }
  function drawLineChart(canvasId, series){
    const c = $(canvasId);
    const ctx = c.getContext("2d");
    const w = c.width, h = c.height;
    clear(ctx,w,h);
    drawAxes(ctx,w,h,"Periode","Aksi");
    const maxV = Math.max(...series.map(d=>d.v)) * 1.1;
    const minV = 0;
    const innerW = w-60, innerH = h-70;
    const x0 = 40, y0 = h-40;

    ctx.save();
    ctx.fillStyle = "rgba(15,23,42,.68)";
    ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
    series.forEach((d,i)=>{
      const x = x0 + (innerW*(i/(series.length-1)));
      ctx.fillText(d.p, x-14, h-18);
    });
    ctx.restore();

    ctx.save();
    ctx.strokeStyle = "rgba(37,99,235,.95)";
    ctx.lineWidth = 3;
    ctx.beginPath();
    series.forEach((d,i)=>{
      const x = x0 + (innerW*(i/(series.length-1)));
      const y = y0 - (innerH*((d.v-minV)/(maxV-minV)));
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.stroke();

    ctx.fillStyle = "rgba(6,182,212,.95)";
    series.forEach((d,i)=>{
      const x = x0 + (innerW*(i/(series.length-1)));
      const y = y0 - (innerH*((d.v-minV)/(maxV-minV)));
      ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = "rgba(15,23,42,.78)";
      ctx.font = "12px " + getComputedStyle(document.body).fontFamily;
      ctx.fillText(formatInt(d.v), x-16, y-10);
      ctx.fillStyle = "rgba(6,182,212,.95)";
    });
    ctx.restore();
  }
  function drawBarChart(canvasId, bars){
    const c = $(canvasId);
    const ctx = c.getContext("2d");
    const w = c.width, h = c.height;
    clear(ctx,w,h);
    drawAxes(ctx,w,h,"Instansi","% Indikator");
    const maxV = 100;
    const innerW = w-70, innerH = h-70;
    const x0 = 50, y0 = h-40;
    const gap = 14;
    const bw = (innerW - gap*(bars.length-1)) / bars.length;

    ctx.save();
    ctx.font = "12px " + getComputedStyle(document.body).fontFamily;

    bars.forEach((d,i)=>{
      const x = x0 + i*(bw+gap);
      const bh = innerH*(d.v/maxV);
      const y = y0 - bh;

      const grad = ctx.createLinearGradient(0,y,0,y0);
      grad.addColorStop(0,"rgba(37,99,235,.90)");
      grad.addColorStop(1,"rgba(6,182,212,.55)");
      ctx.fillStyle = grad;
      ctx.fillRect(x,y,bw,bh);

      ctx.fillStyle = "rgba(15,23,42,.70)";
      const name = d.name.length>12 ? d.name.slice(0,12)+"…" : d.name;
      ctx.textAlign = "center";
      ctx.fillText(name, x+bw/2, h-16);

      ctx.fillStyle = "rgba(15,23,42,.78)";
      ctx.fillText(d.v + "%", x+bw/2, y-8);
    });

    ctx.restore();
  }

  function renderStatus(st){
    const s = st.toLowerCase();
    let cls = "warn";
    if(s.includes("lengkap")) cls="good";
    if(s.includes("perlu")) cls="bad";
    return `<span class="tag ${cls}">${st}</span>`;
  }

  function render(){
    const period = $("period").value;
    const sector = $("sector").value;
    const q = ($("globalSearch").value || "").trim().toLowerCase();

    const d = DATA[period][sector];

    $("kpiActions").textContent = formatInt(d.actions);
    $("kpiIndicators").textContent = formatInt(d.indicators);
    $("kpiCBT").textContent = formatInt(d.cbt);
    $("kpiQuality").textContent = d.quality + "%";

    const qp = qualityPill(d.quality);
    const pill = $("pillQuality");
    pill.classList.remove("good","warn","bad");
    pill.classList.add(qp.cls);
    pill.textContent = "QA/QC: " + qp.txt;

    $("pillActions").textContent = "SRN: " + sector;

    drawLineChart("trendChart", d.trend);
    drawBarChart("completenessChart", d.completeness);

    const rows = d.rows.filter(r => {
      const blob = (r.ind+" "+r.inst+" "+r.src+" "+r.sys.join(" ")+" "+r.st+" "+r.note).toLowerCase();
      return q.length===0 || blob.includes(q);
    });

    const body = $("tblBody");
    body.innerHTML = "";
    rows.forEach(r=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><b>${r.ind}</b></td>
        <td>${r.inst}</td>
        <td>${r.src}</td>
        <td>${r.sys.map(s=>`<span class="tag">${s}</span>`).join("")}</td>
        <td>${renderStatus(r.st)}</td>
        <td>${r.note}</td>
      `;
      body.appendChild(tr);
    });
  }

  // ===== Help modal =====
  const helpBtn = $("helpBtn");
  const helpModal = $("helpModal");
  const helpClose = $("helpClose");
  if(helpBtn && helpModal && helpClose){
    helpBtn.onclick = () => helpModal.style.display = "flex";
    helpClose.onclick = () => helpModal.style.display = "none";
    helpModal.addEventListener("click", (e) => {
      if(e.target === helpModal) helpModal.style.display = "none";
    });
  }

  // ===== Modals from old page (metadata + QA/QC) -> reuse simple modal via alert-like inline =====
  function openSimple(title, html){
    const m = document.createElement("div");
    m.className = "modal";
    m.style.display = "flex";
    m.innerHTML = `
      <div class="box">
        <div class="hd">
          <b>${title}</b>
          <button class="iconclose" type="button">✕</button>
        </div>
        <div class="bd">${html}</div>
      </div>
    `;
    document.body.appendChild(m);
    const x = m.querySelector("button");
    x.onclick = () => m.remove();
    m.addEventListener("click", (e)=>{ if(e.target===m) m.remove(); });
  }

  $("btnMeta").addEventListener("click", ()=>{
    const p = $("period").value, s = $("sector").value;
    const d = DATA[p][s];
    openSimple("Metadata Sektoral (Dummy)", `
      <ul class="help-list">
        <li><b>Periode:</b> ${p}</li>
        <li><b>Sektor:</b> ${s}</li>
        <li><b>Rujukan sistem:</b> SRN (aksi), CBT (pembiayaan), AKSARA (perencanaan), SIPD (konteks wilayah)</li>
        <li><b>Indikator:</b> ${d.indicators} (konsolidasi Lampiran III)</li>
        <li><b>Kualitas:</b> ${d.quality}% (dummy agregat)</li>
      </ul>
      <div class="footer-note">Catatan: nanti metadata diambil dari modul QA/QC dan registrasi sistem.</div>
    `);
  });

  $("btnQA").addEventListener("click", ()=>{
    const p = $("period").value, s = $("sector").value;
    const d = DATA[p][s];
    const qp = qualityPill(d.quality);
    openSimple("Ringkasan QA/QC (Dummy)", `
      <ul class="help-list">
        <li><b>Status agregat:</b> ${qp.txt} (${d.quality}%)</li>
        <li><b>Fokus tindak lanjut:</b> baris berstatus <i>Perlu Verifikasi</i> + perbaikan metadata dokumen rujukan.</li>
      </ul>
      <div class="footer-note">Catatan: ini contoh untuk alur kerja review sebelum penguncian periode.</div>
    `);
  });

  $("btnExport").addEventListener("click", ()=>{
    const p = $("period").value, s = $("sector").value;
    const d = DATA[p][s];
    const text = [
      "Ringkasan MoNEv Adaptasi — Sektoral (Dummy)",
      `Periode: ${p}`,
      `Sektor: ${s}`,
      `Aksi (SRN): ${d.actions}`,
      `Indikator: ${d.indicators}`,
      `Aksi bertag CBT: ${d.cbt}`,
      `Kualitas data: ${d.quality}%`,
      "",
      "Catatan: ekspor ini dummy untuk uji UI/UX."
    ].join("\n");

    const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `Ringkasan_Sektoral_${s}_${p}.txt`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  $("period").addEventListener("change", render);
  $("sector").addEventListener("change", render);
  $("globalSearch").addEventListener("input", render);

  render();
</script>

</body>
</html>
